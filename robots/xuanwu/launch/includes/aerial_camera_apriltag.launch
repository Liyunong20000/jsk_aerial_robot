<?xml version="1.0" encoding="utf-8"?>
<launch>
  <arg name="dev_ns" default="aerial_camera" />
  <arg name="image_width" default="1280" />
  <arg name="image_height" default="720" />
  <arg name="robot_ns" default="xuanwu" />
  <arg name="robot_type" default="aerial_robot" />


  <!-- USB camera -->
  <node name="usb_cam" pkg="usb_cam" type="usb_cam_node" output="screen" >
    <param name="video_device" value="/dev/$(arg dev_ns)" />
    <param name="image_width" value="$(arg image_width)" />
    <param name="image_height" value="$(arg image_height)" />
    <param name="pixel_format" value="mjpeg" />
    <param name="color_format" value="yuv420p" />
    <param name="framerate" value="30"/>
    <param name="camera_frame_id" value="usb_cam" />
    <param name="io_method" value="mmap"/>
    <param name="camera_info_url" value="file://$(find xuanwu)/config/camera_info/elp-l180/720p/$(arg robot_type)/kalibr/1/ost.yaml" />
  </node>

  <!-- image proc -->
  <node name="image_proc" pkg="image_proc" type="image_proc" output="screen">
    <remap from="image_raw" to="/$(arg robot_ns)/usb_cam/image_raw"/>
    <remap from="camera_info" to="/$(arg robot_ns)/usb_cam/camera_info"/>
    <remap from="image_rect_color" to="/$(arg robot_ns)/usb_cam/image_rect_color" />
  </node>

  <!--         Apriltag detection -->
  <include file="$(find apriltag_ros)/launch/continuous_detection.launch">
    <arg name="camera_name" value="/$(arg robot_ns)/usb_cam" />
    <arg name="image_topic" value="image_rect_color" />
    <arg name="node_namespace" default="$(arg robot_ns)_apriltag_ros_continuous_node" />
  </include>
  <rosparam command="load" file="$(find xuanwu)/config/apriltag/xuanwu_bricks/tags.yaml" ns="$(arg robot_ns)_apriltag_ros_continuous_node"/>

<!--   <node name="image_view" pkg="image_view" type="image_view" respawn="false" output="screen"> -->
<!--     <remap from="image" to="$(arg camera_ns)/image_rect_color"/> -->
<!--     <param name="autosize" value="true" /> -->
<!--   </node> -->

</launch>
